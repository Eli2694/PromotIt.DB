ProductID int foreign key references Products(ProductID),
Country nvarchar(15),City nvarchar(15),HomeAddress nvarchar(60),
PostalCode nvarchar(12),PhoneNumber nvarchar(15),OrderDate datetime,OrderConfirmation int)

drop table Orders
select * from [order confirmation]
select * from orders

-- טבלת אישור הזמנות
create table [Order Confirmation](code int primary key identity,
OrderID int,RepresantativeID int)

drop table [Order Confirmation]

-- אישור הזמנה על ידי נציג עסקי
alter procedure OrderConfirmation @OrderID int,@Email nvarchar(255)
as 
begin
   declare @UserID int 
   select @UserID=(select UserID from Users where Email=@Email)
   if not exists(select OrderID from [Order Confirmation] where OrderID = @OrderID)
   begin
        insert into [Order Confirmation] values(@OrderID,@UserID)
		update Orders set OrderConfirmation = 1
		where Orders.OrderID = @OrderID
   end 
end

select * from [Order Confirmation]



--פוקציה בשביל להוריד מוצר אחד מהמלאי
create procedure UpdateUnitsInStockAfterPurchase @ProductID int
as
begin
 update Products 
 set UnitsInStock = UnitsInStock - 1
 where ProductID = ProductID
end

--3פונקציה בשביל לקנות מוצר
--create procedure BuyProduct 

--4 פונקציה בשביל נציג עסקי שיקבל רק את ההזמנות למוצרים אותם הוא תרם
alter procedure GetOrdersThatBelongToMe @Email nvarchar(255)
as
begin
    declare @UserID int
	select @UserID=(select UserID from Users where Email=@Email)
	select Orders.OrderID,Orders.ProductID,Country,City,HomeAddress,PostalCode,PhoneNumber,
	ProductName,UnitPrice,UnitsInStock,OrderDate
	from Orders 
	inner join Products
	on Orders.ProductID = Products.ProductID
	where RepresantativeID = @UserID
	and OrderConfirmation = 0
end

select* from [order Confirmation]
select * from orders
delete from [order Confirmation]

	